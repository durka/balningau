{% extends "base.html" %}

{% block title %}ro gismu{% endblock %}

{% block header %}
<h1>ro gismu</h1>
<div style="float: right">
    {% if user.is_authenticated %}
        Logged in as {{ user }}
        <br/>
        <a href="/kibytci/accounts/logout/">Logout</a>
    {% else %}
        <a href="/kibytci/accounts/login/?next={{ request.path }}">Login</a>
    {% endif %}
</div>

<script type="text/javascript">
    function toggle_form(mode, type, id)
    {
        var form = $('#' + type + id);
        var reply_button = $('#br' + id);
        var edit_button = $('#be' + id);
        var cancel_button = $('#bc' + id);

        if (form.is(':visible')) {
            form.hide();
            reply_button.show();
            edit_button.show();
            cancel_button.hide();
        } else {
            switch (mode)
            {
                case 'reply':
                    $('#id_comment', form).html('');
                    break;
                case 'edit':
                    $('#id_comment', form).html($('#ct' + id).attr('data:source'));
                    break;
            }

            reply_button.hide();
            edit_button.hide();
            cancel_button.show();
            form.show();
        }
    }
</script>
{% endblock %}

{% block content %}
{% load comments %}
{% load markdown %}

    <ol>
        {% for gismu in gimste %}
            <li>
                <b>{{ gismu }}</b>
                <ul>
                    {% for proposal in gismu.proposals %}
                        {% get_comment_count for proposal as comment_count %}
                        <li>
                            <i>{{ proposal.cmene }}</i> ({{ comment_count }} comment{{ comment_count|pluralize }})
                            <p>
                                <small>(type: {{ proposal.get_klesi_display }} / compat: {{ proposal.get_mapti_display }})</small>
                            </p>
                            <p>
                                {{ proposal.velcki|markdown|safe }}
                            </p>
                            {% comment %}
                                {% include "pinka.html" with thing=proposal me="pinka.html" csrf=csrf_token level=0 %}
                            {% endcomment %}
                            <p>
                                <a href="/kibytci/selstidi/{{ proposal.id }}/">Discuss</a>
                            </p>
                        </li>
                    {% endfor %}
                </ul>
            </li>
        {% endfor %}
    </ol>
{% endblock %}

